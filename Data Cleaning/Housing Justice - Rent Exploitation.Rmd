---
title: "Housing Justice - Rent Exploitation"
author: "Sokona Mangane"
date: '2022-07-06'
output: html_document
code_folding: "hide"
---

We downloaded data from Census.gov using the get_acs function, did some data wrangling and cleaning, wrote them as a csv file so that we can import them into RMarkdown

```{r}
#code_folding: "hide" (hides the code but ppl can see the code if they want to)
knitr::opts_chunk$set(echo =  TRUE, warning = FALSE, message = FALSE) #doesn't show the messages or the warings, only code output, must be its in own code chunk to apply to all the subsequent ones
```

``` {r importing data}


#rent exploitation is another way racial capitalism works to extract resources from the black community, hidden from view, how are these things still operating but are less visible to the average viewer?

#importing data
library(readr)
library(tidycensus)
library(tidyverse)
library(tigris)
library(leaflet)
library(sf)
library(DT)
library(GGally)
library(RColorBrewer)


ACS_Housing_Data <- read_csv("Housing_Data.csv")
Income_By_Tenure <- read_csv("Income_By_Tenure.csv")
Tenure <- read_csv("Tenure.csv")
Tenure_By_Income <- read_csv("Tenure_By_Income.csv")
Tenure_By_Race <- read_csv("Tenurebyrace.csv")
Poverty_By_Race <- read_csv("PovertyByRace.csv")
cvl_rva_measures <- read_csv("cvl_rva_measures.csv")


race <- c("White","Black", "Asian", "Hispanic or Latino")

```
## Basic summary statistics: 

# How many renters are there in each county? of which demographics?

Petersburg, Hopewell, Charlottesville and Richmond have the highest percentage of renters.

```{r renter_pop, warning=FALSE, paged.print=TRUE}
# Tenure <- Tenure[, 3:9]
# Tenure <- full_join(Tenure, Tenure_By_Race, by = "County_fips")

Tenure_By_Race_Perc <- Tenure_By_Race %>% 
  mutate(Perc_rentersE = (RentersE/Total_OccupantsE), Perc_ownersE = (OwnersE/Total_OccupantsE)) %>% 
  group_by(County) %>% 
  summarize(Renters = median(Perc_rentersE, na.rm = TRUE), Owners = median(Perc_ownersE, na.rm = TRUE), White_Renters = median((White_rentersE/RentersE), na.rm = TRUE), White_Owners = median((White_ownersE/OwnersE), na.rm = TRUE), Black_Renters = median((Black_rentersE/RentersE), na.rm = TRUE), Black_Owners = median((Black_ownersE/OwnersE), na.rm = TRUE), NativeAm_Owners = median((NativeAm_ownersE/OwnersE), na.rm = TRUE), NativeAm_Renters = median((NativeAm_rentersE/RentersE), na.rm = TRUE),  Asian_Owners = median((Asian_ownersE/OwnersE), na.rm = TRUE), Asian_Renters = median((Asian_rentersE/RentersE), na.rm = TRUE), PacificIslander_Owners = median((PacificIslander_ownerE/OwnersE), na.rm = TRUE), PacificIslander_Renters = median((PacificIslander_renterE/RentersE), na.rm = TRUE), HispanicLatino_Owners = median((HispanicLatino_ownerE/OwnersE), na.rm = TRUE), HispanicLatino_Renters = median((HispanicLation_renterE/RentersE), na.rm = TRUE)) %>% 
  mutate(across(c(2:14), scales::percent)) %>% 
  arrange(desc(Renters)) %>% 
  select(1:3,4,6,9,11,13,15,5,7,8,10,12,14)


sketch = htmltools::withTags(table(
  class = 'display',
  thead(
    tr(
      th(rowspan = 2, 'County'),
      th(colspan = 6, 'Renters'),
      th(colspan = 6, 'Owners')
    ),
    tr(
      lapply(c('White_Renters', 'Black_Renters', 'NativeAm_Renters', 'Asian_Renters', "PacificIslander_Renters", "HispanicLatino_Renters", 'White_Owners', 'Black_Owners', 'NativeAm_Owners', 'Asian_Owners', "PacificIslander_Owners", "HispanicLatino_Owners"), th)
    )
  )
))

DT_Tenure_By_Race <- Tenure_By_Race_Perc[,c(1,4:15)]

datatable(DT_Tenure_By_Race, 
          caption = htmltools::tags$caption(
            style = 'caption-side: bottom; text-align: center;',
            'Table 1: ', htmltools::em('Median Percentage of Renters and Owners in Each County (by Demographics)')),
          container = sketch, 
          rownames = FALSE, 
          extensions = 'Buttons', 
          options = list(dom='Bfrtip',
                         buttons=c('copy', 'csv', 'excel', 'print', 'pdf')
                         )
          )

#how to make data mpt extend screen and show on next page



#can do a scatterplot matrix and DataTables to provide summary statistics
#maps, leaflets
#models



```


```{r}

Tenure_perc_by_race <- Tenure_By_Race %>% 
  mutate(Perc_WRenters = (White_rentersE/RentersE), Perc_WOwners = (White_ownersE/OwnersE), Perc_BRenters = (Black_rentersE/RentersE), Perc_BOwners = (Black_ownersE/OwnersE), Perc_NativeAmOwners = (NativeAm_ownersE/OwnersE), Perc_NativeAmRenters = (NativeAm_rentersE/RentersE),  Perc_AsianOwners = (Asian_ownersE/OwnersE), Perc_AsianRenters = (Asian_rentersE/RentersE), Perc_PacificIslanderOwner = (PacificIslander_ownerE/OwnersE), Perc_PacificIslanderRenter = (PacificIslander_renterE/RentersE), Perc_HispanicLatinoOwner = (HispanicLatino_ownerE/OwnersE), Perc_HispanicLationRenterE = (HispanicLation_renterE/RentersE)) %>%
  select(1:5, 48:59)

Tenure_perc_by_race <- Tenure_perc_by_race %>%
  pivot_longer(., cols = c(Perc_AsianOwners, Perc_WRenters, Perc_WOwners, Perc_BOwners, Perc_BRenters, Perc_NativeAmOwners, Perc_NativeAmRenters, Perc_AsianRenters, Perc_PacificIslanderOwner, Perc_PacificIslanderRenter, Perc_HispanicLatinoOwner, Perc_HispanicLationRenterE), names_to = "Variable", values_to = "Percentage (Estimated)") %>% 
  mutate(Race = case_when(
    str_detect(Variable, "Asian") ~ "Asian",
    str_detect(Variable, "B") ~ "Black",
    str_detect(Variable, "NativeAm") ~ "Native American",
    str_detect(Variable, "PacificIslander") ~ "Pacific Islander",
    str_detect(Variable, "Hispanic") ~ "Hispanic or Latino",
    str_detect(Variable, "WRenters") ~ "White",
    str_detect(Variable, "WOwners") ~ "White"
  ), 
  Variable = case_when(
    str_detect(Variable, "Owner") ~ "Owner",
    str_detect(Variable, "Renter") ~ "Renter"
  )) 


Tenure_perc_by_race <- rename(Tenure_perc_by_race, Tenure_Type = Variable)

# Tenure_perc_by_race$`Percentage (Estimated)` <- round(Tenure_perc_by_race$`Percentage (Estimated)`, 2)
# Tenure_perc_by_race %>% 
#   filter(Tenure_Type == "Renter" & Race %in% race) %>% 
#   ggplot(aes(x = Tenure_Type, y = `Percentage (Estimated)`)) +
#   geom_boxplot() + 
#   facet_wrap(~Race)

#Same graph different output
Tenure_perc_by_race %>% 
  filter(Tenure_Type == "Renter" & Race %in% race ) %>% 
  ggplot(aes(x = Tenure_Type, y = `Percentage (Estimated)`, fill = Race)) +
  scale_fill_viridis_d() +
  geom_boxplot() + 
  facet_wrap(~Region) +
  labs(title = "Racial Composition of Renters in Charlottesville and Richmond, Virginia", x = "Tenure Type")


#Chartlottesville has way less data points

ACS_Housing_Data %>% 
  group_by(Region) %>% 
  summarise(sum = n(), Percent = n()/317)

Tenure_perc_by_race %>% 
  filter(Tenure_Type == "Renter") %>% 
  group_by(County, Race) %>% 
  select(4,7,8) %>% 
  summarize(Perc_Renters = median(Tenure_perc_by_race$`Percentage (Estimated)`, na.rm = TRUE)) %>% 
  arrange(desc(Perc_Renters))




```
(backgournd)

# relationship between demographics of renters and rent expoitation?


```{r}
Tenure_and_Housing_Data <- full_join(Tenure_perc_by_race, ACS_Housing_Data, by = "GEOID") %>% 
  select(1,6:30)


Tenure_and_Housing_Data  %>% 
  filter(Tenure_Type == "Renter" & Race %in% race) %>% 
  ggplot(aes(x = `Percentage (Estimated)`, y = RentTaxRatio, color = Region.y)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") + 
  facet_wrap(~Race) + 
  labs(title = "Demographic of Renter vs Rent Exploitation in Charlottesville and Richmond, VA", x = "Percentage of Renter (Estimated)", y = "Rent to Tax Ratio", color = "Region") 


# Tenure_and_Housing_Data  %>% 
#   filter(Tenure_Type == "Renter" & Race %in% race) %>% 
#   ggplot(aes(x = `Percentage (Estimated)`, y = RentTaxRatio)) +
#   geom_point(alpha = 0.3) +
#   geom_smooth(method = "lm") + 
#   facet_wrap(~Region.y)

#Before, it was facet_wrapped by race and colored based on the tenure typem but because I filtered out for renters, idk which graph looks better and is "easier" to read and understand, should I remove geom_point, even though she told me to add it?




```


```{r}
#modeling whats above


lm1 <- lm(RentTaxRatio ~ `Percentage (Estimated)`:factor(Race), data = Tenure_and_Housing_Data)
lm1 



```



# What is the average rent, income, and real estate taxes paid in each County? 

Highest rent: Fluvanna, Chesterfield, Henrico and Albemarle
Highest median real estate taxes: Albemare, Charlottesville, Richmond, and Chesterfeild

```{r Avg. Rent, Income, and Real Estate Taxes}
ACS_Housing_Data |>
  group_by(County) |>
  summarize(Median_rent = median(MedianRentE, na.rm = TRUE), Median_tax = median(MedianTaxesE, na.rm = TRUE), Median_income = median(MedianIncomeE, na.rm = TRUE))

```


Census Tract 4.01 - Friendship Court

Census Tract 6 - Bice House

# What is the average rent to tax ratio in each county?

Highest Rent Tax Ratio: Petersburg City, Chesterfeild, and Nelson

```{r Avg. Rent-to-Tax Ratio}

ACS_Housing_Data$RentTaxRatio <- round(ACS_Housing_Data$RentTaxRatio, 3)

all<- b <- Tenure_and_Housing_Data %>% 
  filter(`Percentage (Estimated)` >= 0.5, Race == "Black", Tenure_Type == "Renter") %>% 
   group_by(Region.y) %>% 
  summarize(Rent_Tax_RaTio_Black = median(RentTaxRatio, na.rm = TRUE))


b <- Tenure_and_Housing_Data %>% 
  filter(`Percentage (Estimated)` >= 0.5, Race == "Black", Tenure_Type == "Renter") %>% 
   group_by(Region.y) %>% 
  summarize(Rent_Tax_RaTio_Black = median(RentTaxRatio, na.rm = TRUE))
  
all

b

```


# What is the average percent of rent of income in each county? Thus, which county is the most rent burdened?

Richmond, Charlottesville and Nelson are the most rent burdened counties, but no counties appear to be severly rent burdened (more than 50), on average. 

```{r Avg. Rent Burdened}

ACS_Housing_Data %>% 
  group_by(County) %>% 
  summarize(Median_perc_rent_income = median(PercRentBurdenE, na.rm = TRUE)) %>% 
  arrange(desc(Median_perc_rent_income))
```

Here is a more detailed look at who's rent burded and severely rent burdened in each County, with Richmond still being the most rent burdened.
``` {r}



ACS_Housing_Data <- ACS_Housing_Data %>% 
  mutate(Rent_Burdened = case_when(
    PercRentBurdenE >= 30 & PercRentBurdenE < 50  ~ "Yes",
    PercRentBurdenE >= 50 ~"Yes, Severely",
    TRUE ~ "No")
    ) 

Rent_Burden_stats <- ACS_Housing_Data %>% 
  filter(Rent_Burdened != "No") %>% 
  group_by(Rent_Burdened,  County) %>% 
  summarize(Percent = round((n()/317)*100, 3)) %>% 
  arrange(desc(Percent))

knitr::kable(Rent_Burden_stats)


```  


As we can see here, alhtough it may not look like it from the numbers above, a lot of counties (the biggest census tracts too) are rent burdened, some even severely.

```{r}

counties <- c("Albemarle", "Charlottesville", "Fluvanna", "Greene", "Louisa", "Nelson", "Richmond city", "Henrico", "Chesterfield", "Hopewell", "Petersburg")
countytracts <- tracts(state = "VA", county = counties, year = 2020)

countytracts <- countytracts |>
  mutate(GEOID = as.numeric(countytracts$GEOID)) 

HousingDataSpatial <- full_join(ACS_Housing_Data, countytracts, by = "GEOID") |>
  sf::st_as_sf() |>
  mutate(INTPTLAT = as.numeric(countytracts$INTPTLAT), INTPTLON = as.numeric(countytracts$INTPTLON))|> 
   sf::st_transform(crs = '+proj=longlat +datum=WGS84') #one way to reference a CRS, another way (which Claibourne used) is cvl_rents <- st_transform(cvl_rents, 4326) because leaflet expects the crs to be 4326


pal <-  colorNumeric("YlOrRd", HousingDataSpatial$PercRentBurdenE, reverse = TRUE)

HousingDataSpatial %>% 
leaflet() %>% 
  addTiles() %>% 
  addPolygons(color = "black",
              fillColor = ~pal(PercRentBurdenE),
              fillOpacity = 0.6,
              weight = 2,
              highlight = highlightOptions(
                weight = 3,
                fillOpacity = 0.9,
                bringToFront = T),
              popup = paste0("County: ", HousingDataSpatial$County, "<br>",
                             "Tract: ", HousingDataSpatial$NAMELSAD, "<br>",
                             "Percentage of Rent Burden: ", HousingDataSpatial$PercRentBurdenE)) %>% 
  addLegend(pal = pal, 
            values = ~PercRentBurdenE, 
            opacity = 0.7, 
            title = "Percentage of Rent Burden (2020)", 
            position = "bottomleft")


#FOR POSTER
HousingDataSpatial %>% 
  filter(Region == "Charlottesville") %>% 
  ggplot() + 
  geom_sf(aes(fill=PercRentBurdenE)) +
  scale_fill_viridis_c() +
  scale_color_viridis_c() +
  ggtitle("Degree of Rent Burden in Charlottesville", subtitle = "2020 ACS") +
  labs(fill = "Rent as a Percentage of Household Income")

Rent_Burden_rvl_sf <- HousingDataSpatial %>% 
  filter(Region == "Richmond") %>% 
  ggplot() + 
  geom_sf(aes(fill=PercRentBurdenE)) +
  scale_fill_viridis_c() +
  scale_color_viridis_c() +
  ggtitle("Degree of Rent Burden in Richmond", subtitle = "2020 ACS") +
  labs(fill = "Rent as a Percentage of Household Income")


ggsave("Degree of Rent Burden in Richmond.png", Rent_Burden_rvl_sf)


Rent_Burdened_Stats_Detailed <- HousingDataSpatial %>% 
  filter(PercRentBurdenE >= 30) %>% 
  select(3,12) %>% 
  arrange(desc(PercRentBurdenE))

knitr::kable(Rent_Burdened_Stats_Detailed)


```


# relationship between demographics of renters and being rent burndened?

``` {r}
# 
# Tenure_and_Housing_Data  %>% 
#   filter(Tenure_Type == "Renter") %>% 
#   ggplot(aes(x = `Percentage (Estimated)`, y = PercRentBurdenE, color = Tenure_Type)) +
#   geom_point(alpha = 0.3) +
#   geom_smooth(method = "lm") + 
#   facet_wrap(~Race)


#different graph, same 

Tenure_and_Housing_Data  %>% 
  filter(Tenure_Type == "Renter" & Race %in% race) %>% 
  ggplot(aes(x = `Percentage (Estimated)`, y = PercRentBurdenE, color = Region.y)) +
  scale_color_viridis_d() +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") + 
  facet_wrap(~Race) +
  labs(title = "Demographic of Renter vs Rent Burden in CVL and RVA", x = "Percentage of Renter (Estimated)", y = "Rent as a Percentage of Income", color = "Region")



```

```{r}
#model whats above



lm3 <- lm(PercRentBurdenE ~ Race:`Percentage (Estimated)`, data = Tenure_and_Housing_Data)
lm3



```



```{r}
#relationship btw those who are rent burdened and rent tax ratio?
Tenure_and_Housing_Data %>% 
ggplot(aes(x = PercRentBurdenE, y = RentTaxRatio)) + 
  geom_point(alpha = 0.3) +
    geom_smooth(method = "lm") +
  facet_wrap(~Region.y)





```

```{r}
#model whats above

lm5 <- lm(RentTaxRatio ~ PercRentBurdenE, data = Tenure_and_Housing_Data)
lm5

```


# What does the income and ratio look like there?

Although these three are the most rent burdened, it isn't obvious based on its rent to tax ratio and median household income, except for in Nelson county (which only has 5 observations in the tract)

1. Richmond: Median Income is $53,216.5 and the Rent to Tax Ratio is 0.484
2. Charlottesville: Median Income is $62,477.5 and the Rent to Tax Ratio is 0.4325
3. Nelson: Median Income is $53,579 and the Rent to Tax Ratio is 0.71

# How many are below the poverty level in this County? and which demographics?

We can reach the same conclusions here, with Richmond having the _third_ highest percentage of those below the poverty level.

1. Richmond: On average, 17.6% of the county is below the poverty level and people who are Black and Asian have the highest average percent of those below the poverty level.  
2. Charlottesville: On average, 15.3% of the county is below the poverty level and people who are Hispanic or Latino and Asian have the highest average percent of those below the poverty level.  
3. Nelson: On average, 12.9% of the county is below the poverty level and people who are Asian have the highest average percent of those below the poverty level (50%).  

# What is the income distribution in this census tract look like?

```{r income_levels (rent burdened counties)}

```


# Which county has the most students (includes Undergraduate and Graduate students)?

No one county has a disproportionate amount of students compared to the other, however, Richmond, Charlottesville, and Henrico have the highest student populations

```{r}

 ACS_Housing_Data %>% 
  group_by(County) %>% 
  summarize(Median_perc_students = median(Perc_StudentsE, na.rm = TRUE))

```

*More than 50% of pop. in tracts in Richmond and Charlottesville city consist of students, but doesn't seem like the case for Henrico!

##Students

```{r bar graph of percent of students in each census tract in Richmond, Charlottesville and Henrico }



#pal1 <- colorNumeric("Greens", domain = HousingDataSpatial$County, HousingDataSpatial$County)

#creating map and adding layers

perc_student_counties <- c("Richmond City", "Charlottesville", "Henrico")

Moststudents <- HousingDataSpatial %>% 
  filter(County %in% perc_student_counties)

pal1 <-  colorNumeric("YlOrRd", Moststudents$Perc_StudentsE, reverse = TRUE) #the reverse argument reverses the color palette 


Moststudents %>% 
  leaflet() %>% 
  addTiles() %>% 
  addPolygons(color = "black",
              fillColor = ~pal1(Perc_StudentsE),
              weight = 2,
              fillOpacity = 0.6,
              highlight = highlightOptions(
                weight = 3,
                fillOpacity = 0.9,
                bringToFront = T),
              popup = paste0("County: ", Moststudents$County, "<br>",
                             "Tract: ", Moststudents$NAMELSAD, "<br>",
                             "Percentage of Rent Burden: ", Moststudents$Perc_StudentsE)) %>% #to add hovering functionality check what she put for the highlight argument and to add popups, check what she put for the popup argument
  addLegend(pal = pal1, 
            values = ~Perc_StudentsE, 
            opacity = 0.7, 
            title = "Highest Percentage of Students in Charlottesville and Richmond regions for 2020", 
            position = "bottomleft")

HousingDataSpatial %>% 
  filter(Perc_StudentsE >= 50) %>% 
  select(3,22) %>% 
  arrange(desc(Perc_StudentsE))

#ask soumya/claibourne why census tracts that aren't shaded ar being shown (esp since I filtered the dataframe)


#Tabset


###heading 1{.tabset}

####every heading under is a tabset!
#Can make the first tabs a leaflet and the third one as a scatterplot 

```

*Can see that Henrico Coutny has quite a few tracts with more than 10% of students and one with more than 15%, but it doesn't compare to the major cities in VA

```{r}
HousingDataSpatial %>% 
  filter(County == "Henrico") %>% 
  ggplot(aes(x = NAME.y, y = Perc_StudentsE)) + 
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```


# What does the income, and ratio look like there? 


1. Richmond: Median Income is $53,216.5 and the Rent to Tax Ratio is 0.484
2. Charlottesville: Median Income is $62,477.5 and the Rent to Tax Ratio is 0.433
3. Henrico: Median Income is $69,827 and the Rent to Tax Ratio is 0.659



# How does this compare to the average gini index and who's below poverty in each county?



```{r Below_poverty and Gini Index}
Poverty_By_Race %>% 
  group_by(County) %>% 
  summarize(Median_perc_below_poverty = median(Perc_Total_BelowPovertyE, na.rm = TRUE), Median_Gini_Index = median(Gini_IndexE, na.rm = TRUE))

Poverty_Stats <- Poverty_By_Race %>% 
  filter(Gini_IndexE >= 0.5 & Perc_Total_BelowPovertyE >= 0.5) %>% 
  select(3,4,36,50) %>% 
  arrange(desc(Gini_IndexE))

knitr::kable(Poverty_Stats)

Poverty_By_Race %>% 
  ggplot(aes(x = Perc_Total_BelowPovertyE, y = Gini_IndexE)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") +
  facet_wrap(~Region)

#model 

lm(Gini_IndexE ~ Perc_Total_BelowPovertyE, data = Poverty_By_Race)

lm(Perc_Total_BelowPovertyE ~ Gini_IndexE, data = Poverty_By_Race)




```


# Which demographics are most likely to be below poverty and above (or at) in each county?

```{r Demographics of those below and above(or at) poverty}

PovertyBy_Race_County <- Poverty_By_Race %>% 
  group_by(County) %>% 
  summarize(Median_Perc_WBelowPoverty = median((Perc_BelowPoverty_WhiteE), na.rm = TRUE), Median_Perc_BBelowPoverty = median((Perc_BelowPoverty_BlackE), na.rm = TRUE), Median_Perc_NativeAm_BelowPoverty = median((Perc_BelowPoverty_NativeAmE), na.rm = TRUE),  Median_Perc_Asian_BelowPoverty = median((Perc_BelowPoverty_AsianE), na.rm = TRUE), Median_Perc_PacificIslander_BelowPoverty = median((Perc_BelowPoverty_PacificIslanderE), na.rm = TRUE), Median_Perc_HispanicLatino_BelowPoverty = median((Perc_BelowPoverty_HispanicLatinoE), na.rm = TRUE))

knitr::kable(PovertyBy_Race_County)



#graph!            
            
```

#Relationship btw those who are rent burdended and gini index?


#Scatterplot Matrix 

```{r}
# 
# 
# pbr_matrix <- ggpairs(Poverty_By_Race, mapping = aes(color = Region), columns = c(38, 39, 40, 43, 50, 36))
# 
# pbr_matrix
```

```{r isolation index}


#
 HDSpatial_Updated <- HousingDataSpatial %>%
   mutate(county_tract = paste(COUNTYFP,TRACTCE, sep = "")) 
#
 cvl_rva_measures_Spatial <- full_join(cvl_rva_measures, HDSpatial_Updated, by = "county_tract") %>%
   sf::st_as_sf() |>
   sf::st_transform(crs = 4326)
#
pal2 <-  colorNumeric("viridis", cvl_rva_measures_Spatial$iso_b_block, reverse = TRUE)

cvl_rva_measures_Spatial %>%
 leaflet() %>%
   addTiles() %>%
   addPolygons(color = "black",
               fillColor = ~pal2(iso_b_block),
               fillOpacity = 0.6,
               weight = 2,
               highlight = highlightOptions(
                 weight = 3,
                 fillOpacity = 0.9,
                 bringToFront = T),
               popup = paste0("County: ", cvl_rva_measures_Spatial$County, "<br>",
                              "Tract: ", cvl_rva_measures_Spatial$NAME.x, "<br>",
                              "Isolation Index: ", cvl_rva_measures_Spatial$iso_b_block)) %>%
  addLegend(pal = pal2,
             values = ~iso_b_block,
             opacity = 0.7,
            title = "Black Isolation Index (2020)",
             position = "bottomleft")


# Code above not working, all appearing as the same color...



#FOR THE POSTER
Iso_index_cvl_rva <- cvl_rva_measures_Spatial %>% 
  ggplot() + 
  geom_sf(aes(fill=iso_b_block)) +
  scale_fill_viridis_c() +
  scale_color_viridis_c() +
  ggtitle("Black Isolation Index in Charlottesville and Richmond, VA", subtitle = "Data from the 2020 American Community Survey (ACS)") +
  labs(fill = "Isolation Index")

Iso_index_rva <- cvl_rva_measures_Spatial %>%
  filter(Region == "Richmond") %>% 
  ggplot() + 
  geom_sf(aes(fill=iso_b_block)) +
  scale_fill_viridis_c() +
  scale_color_viridis_c() +
  ggtitle("Black Isolation Index in Richomond", subtitle = "Data from the 2020 American Community Survey (ACS)") +
  labs(fill = "Isolation Index")

ggsave("Black Isolation Index in Richmond.png", Iso_index_cvl_rva)




```



#Relationshiop btw Rent exploitation and segregation meausres 

```{r}



lm(RentTaxRatio ~ dissim_wb_block, data = cvl_rva_measures_Spatial) #-0.4407

lm(RentTaxRatio ~ iso_b_block, data = cvl_rva_measures_Spatial) #0.3226

cvl_rva_measures_Spatial %>% 
  ggplot(aes(x = dissim_wb_block, y = RentTaxRatio)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") +
  facet_wrap(~Region)

cvl_rva_measures_Spatial %>% 
  ggplot(aes(x = iso_b_block, y = RentTaxRatio)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm") +
  facet_wrap(~Region)




```


Plots from Previous RMarkdown on distribution

```{r distribution plots from old RMD}

ACS_Housing_Data %>% 
  ggplot(aes(ACS_Housing_Data$PercRentBurdenE, fill = Region)) + 
  geom_histogram()


#distrubtion of the rent tax ratio as a whole
ACS_Housing_Data %>% 
  ggplot(aes(ACS_Housing_Data$RentTaxRatio)) + 
  geom_histogram()

#distrubtion of the rent tax ratio by county
ACS_Housing_Data %>% 
  ggplot(aes(ACS_Housing_Data$RentTaxRatio)) + 
  geom_histogram() +
  facet_wrap(~County)

#distrubtion of the rent tax ratio by county (boxplot)
ACS_Housing_Data |>
  ggplot() +
  aes(x = County, y = RentTaxRatio) +
  geom_boxplot() 

```

